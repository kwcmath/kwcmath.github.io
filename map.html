<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº¤é€šè²»é‡Œç¨‹è¨ˆç®—</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* API Key è¨­å®šå€åŸŸ */
        .api-setup {
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
        }

        .api-setup h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .api-setup p {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
            line-height: 1.6;
        }

        .api-input-group {
            max-width: 600px;
            margin: 0 auto 30px;
        }

        .api-input-group input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            font-family: 'Courier New', monospace;
        }

        .api-input-group input:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .api-tutorial {
            background: rgba(255, 255, 255, 0.8);
            padding: 25px;
            border-radius: 15px;
            margin: 30px auto;
            max-width: 700px;
            text-align: left;
            border-left: 4px solid #4facfe;
        }

        .api-tutorial h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .api-tutorial ol {
            color: #555;
            line-height: 1.8;
            padding-left: 20px;
        }

        .api-tutorial li {
            margin-bottom: 8px;
        }

        .api-tutorial a {
            color: #4facfe;
            text-decoration: none;
            font-weight: 600;
        }

        .api-tutorial a:hover {
            text-decoration: underline;
        }

        /* ä¸»è¦æ‡‰ç”¨å€åŸŸ */
        .content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            padding: 30px;
        }

        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .cost-calculation-panel {
            background: #f8f9fa;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        }

        .controls {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        }

        .api-status {
            background: linear-gradient(45deg, #00b894 0%, #00cec9 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        .input-group input:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .input-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            cursor: pointer;
        }

        .input-group select:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            position: relative;
        }

        .radio-option:hover {
            border-color: #4facfe;
            box-shadow: 0 2px 8px rgba(79, 172, 254, 0.1);
        }

        .radio-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .radio-custom {
            width: 20px;
            height: 20px;
            border: 2px solid #ddd;
            border-radius: 50%;
            margin-right: 12px;
            position: relative;
            transition: all 0.3s ease;
        }

        .radio-option input[type="radio"]:checked+.radio-custom {
            border-color: #4facfe;
            background: #4facfe;
        }

        .radio-option input[type="radio"]:checked+.radio-custom::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: white;
        }

        .radio-option input[type="radio"]:checked~.radio-text {
            color: #4facfe;
            font-weight: 600;
        }

        .radio-text {
            font-size: 16px;
            color: #333;
            transition: all 0.3s ease;
        }

        .btn {
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
            width: calc(60% - 10px);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(79, 172, 254, 0.4);
        }

        .btn-api {
            width: auto;
            padding: 15px 40px;
            font-size: 18px;
        }

        .btn-clear {
            background: linear-gradient(45deg, #ff7675 0%, #fd79a8 100%);
            box-shadow: 0 4px 15px rgba(255, 118, 117, 0.3);
        }

        .btn-print {
            background: linear-gradient(45deg, #6c5ce7 0%, #a29bfe 100%);
            box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3);
            width: 100%;
            margin: 10px 0;
        }

        .btn-clear:hover {
            box-shadow: 0 8px 20px rgba(255, 118, 117, 0.4);
        }

        .btn-print {
            background: linear-gradient(45deg, #6c5ce7 0%, #a29bfe 100%);
            box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3);
            width: 100%;
            margin: 10px 0;
        }

        .btn-print:hover {
            box-shadow: 0 8px 20px rgba(108, 92, 231, 0.4);
        }

        .print-header {
            display: none;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #333;
            padding-bottom: 20px;
        }

        .print-header h1 {
            font-size: 28px;
            color: #333;
            margin-bottom: 10px;
            font-weight: bold;
        }

        /* åˆ—å°æ™‚é¡¯ç¤ºæ¨™é¡Œ */
        @media print {
            .print-header {
                display: block !important;
            }
        }

        @media print {
            * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
            }

            body {
                background: white !important;
                margin: 0;
                padding: 20px;
                font-family: Arial, sans-serif;
            }

            .no-print {
                display: none !important;
            }

            .right-panel {
                display: block !important;
                width: 100% !important;
                margin: 0 !important;
                gap: 20px !important;
            }

            .map-container {
                height: 400px !important;
                width: 100% !important;
                margin-bottom: 20px !important;
                border: 2px solid #333 !important;
                page-break-inside: avoid;
            }

            .route-info {
                background: white !important;
                border: 2px solid #333 !important;
                margin: 10px 0 !important;
                page-break-inside: avoid;
            }

            .route-info h3 {
                color: #333 !important;
                font-size: 16px !important;
                font-weight: bold !important;
                border-bottom: 1px solid #333 !important;
                padding-bottom: 8px !important;
            }

            .btn-route-select {
                display: none !important;
            }

            .route-details {
                display: flex !important;
                gap: 15px !important;
            }

            .route-stat {
                background: #f8f9fa !important;
                border: 1px solid #333 !important;
                padding: 10px !important;
                text-align: center !important;
                flex: 1 !important;
            }

            .route-stat .label {
                font-size: 12px !important;
                color: #333 !important;
                font-weight: bold !important;
                margin-bottom: 5px !important;
            }

            .route-stat .value {
                font-size: 14px !important;
                font-weight: bold !important;
                color: #333 !important;
            }

            .cost-calculation-panel {
                background: white !important;
                border: 2px solid #333 !important;
                margin-top: 20px !important;
                page-break-inside: avoid;
            }

            .route-comparison {
                background: #f0f0f0 !important;
                border: none !important;
                margin: 0 !important;
            }

            .route-comparison h3 {
                color: #333 !important;
                font-size: 18px !important;
                font-weight: bold !important;
                margin-bottom: 15px !important;
            }

            .cost-calculation {
                background: white !important;
            }

            .cost-selector label {
                color: #333 !important;
                font-weight: bold !important;
            }

            .radio-option {
                border: 1px solid #333 !important;
                background: white !important;
            }

            .radio-option input[type="radio"]:checked~.radio-text {
                color: #333 !important;
                font-weight: bold !important;
            }

            .cost-breakdown {
                margin-top: 15px !important;
            }

            .cost-item {
                background: white !important;
                border: 1px solid #333 !important;
                color: #333 !important;
                margin-bottom: 8px !important;
                padding: 10px !important;
            }

            .cost-item.total-cost {
                background: #f0f0f0 !important;
                border: 2px solid #333 !important;
                font-weight: bold !important;
                font-size: 16px !important;
            }

            .cost-label,
            .cost-value {
                color: #333 !important;
            }

            /* éš±è—ä¸éœ€è¦çš„å…ƒç´  */
            .container>.header,
            .content>.controls {
                display: none !important;
            }

            .content {
                display: block !important;
                padding: 0 !important;
            }
        }

        .btn-change-api {
            background: linear-gradient(45deg, #fdcb6e 0%, #e17055 100%);
            box-shadow: 0 4px 15px rgba(253, 203, 110, 0.3);
            width: 100%;
            margin: 0 0 20px 0;
        }

        .btn-change-api:hover {
            box-shadow: 0 8px 20px rgba(253, 203, 110, 0.4);
        }

        .route-info {
            background: #fff;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-left: 4px solid #4facfe;
        }

        .route-info h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-route-select {
            background: linear-gradient(45deg, #00b894 0%, #00cec9 100%);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 10px;
        }

        .btn-route-select:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 184, 148, 0.4);
        }

        .btn-route-select.active {
            background: linear-gradient(45deg, #fd79a8 0%, #fdcb6e 100%);
            box-shadow: 0 4px 12px rgba(253, 121, 168, 0.4);
        }

        .route-comparison {
            background: linear-gradient(135deg, #a8e6cf 0%, #88d8a3 100%);
            padding: 20px;
            border-radius: 15px;
            color: #2d3436;
            margin: 0;
        }

        .route-comparison-stats {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            color: #2d3436;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        }

        .right-panel #routeInfo {
            background: #f8f9fa;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
            padding: 0;
            margin: 0;
        }

        .right-panel .route-info {
            margin: 0;
            border-radius: 0;
            box-shadow: none;
            border-left: none;
            border-bottom: 1px solid #e1e5e9;
        }

        .right-panel .route-info:last-child {
            border-bottom: none;
            border-radius: 0 0 15px 15px;
        }

        .right-panel .route-info:first-child {
            border-radius: 15px 15px 0 0;
        }

        .route-comparison h3,
        .route-comparison-stats h3 {
            margin-bottom: 15px;
            font-size: 1.2em;
            color: #2d3436;
        }

        .cost-calculation {
            background: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .cost-selector {
            margin-bottom: 20px;
        }

        .cost-selector label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3436;
        }

        .cost-selector label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3436;
        }

        .cost-selector select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cost-selector select:focus {
            outline: none;
            border-color: #88d8a3;
            box-shadow: 0 0 0 3px rgba(136, 216, 163, 0.1);
        }

        .cost-selector select:hover {
            border-color: #88d8a3;
        }

        .cost-breakdown {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .cost-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 8px;
        }

        .cost-item.total-cost {
            background: linear-gradient(45deg, #fd79a8 0%, #fdcb6e 100%);
            color: white;
            font-weight: bold;
            font-size: 1.1em;
        }

        .cost-label {
            font-weight: 600;
        }

        .cost-value {
            font-weight: bold;
        }

        .trip-info {
            background: rgba(255, 255, 255, 0.9);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
        }

        .trip-detail {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding: 8px 0;
        }

        .trip-detail:last-child {
            margin-bottom: 0;
        }

        .trip-label {
            font-weight: 600;
            color: #2d3436;
            font-size: 16px;
        }

        .trip-value {
            font-weight: bold;
            color: #2d3436;
            font-size: 16px;
            text-align: right;
            max-width: 60%;
            word-break: break-word;
        }

        .comparison-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .comparison-item {
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .comparison-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 5px;
            color: #666;
        }

        .comparison-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #2d3436;
        }

        .route-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .route-stat {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .route-stat .label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .route-stat .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }

        .map-container {
            background: #fff;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            height: 300px;
            flex-shrink: 0;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 16px;
        }

        .loading.show {
            display: block;
        }

        .error {
            background: #ff7675;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            display: none;
        }

        .error.show {
            display: block;
        }

        .success {
            background: #00b894;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            display: none;
        }

        .success.show {
            display: block;
        }

        .map-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            background: #f8f9fa;
            color: #666;
            font-size: 18px;
            text-align: center;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2em;
            }

            .route-details {
                grid-template-columns: 1fr;
            }

            @media (max-width: 768px) {
                .content {
                    grid-template-columns: 1fr;
                }

                .header h1 {
                    font-size: 2em;
                }

                .route-details {
                    grid-template-columns: 1fr;
                }

                .btn {
                    width: 100%;
                    margin: 5px 0;
                }

                .comparison-stats {
                    grid-template-columns: 1fr;
                }

                .route-info h3 {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: 10px;
                }

                .btn-route-select {
                    margin-left: 0;
                    align-self: flex-start;
                }

                .radio-group {
                    gap: 8px;
                }

                .radio-text {
                    font-size: 14px;
                }

                .map-container {
                    height: 250px;
                }
            }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš— äº¤é€šè²»é‡Œç¨‹è¨ˆç®—</h1>
            <p>é¸æ“‡äº¤é€šå·¥å…·ï¼Œè¨ˆç®—è·¯ç·šåŠäº¤é€šè²»ç”¨</p>
        </div>

        <!-- API Key è¨­å®šé é¢ -->
        <div class="api-setup" id="apiSetup">
            <h2>ğŸ”‘ è«‹è¼¸å…¥ Google Maps API Key</h2>
            <p>ç‚ºäº†ä½¿ç”¨äº¤é€šè²»é‡Œç¨‹è¨ˆç®—åŠŸèƒ½ï¼Œæ‚¨éœ€è¦æä¾›ä¸€å€‹æœ‰æ•ˆçš„ Google Maps API Key</p>

            <div class="api-input-group">
                <input type="text" id="apiKeyInput" placeholder="è«‹è¼¸å…¥æ‚¨çš„ Google Maps API Key">
            </div>

            <button class="btn btn-api" onclick="validateAndSetApiKey()">ğŸš€ é–‹å§‹ä½¿ç”¨</button>

            <div class="error" id="apiError"></div>
            <div class="success" id="apiSuccess"></div>

            <div class="api-tutorial">
                <h3>ğŸ“š å¦‚ä½•ç²å– Google Maps API Keyï¼Ÿ</h3>
                <ol>
                    <li>å‰å¾€ <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a></li>
                    <li>å»ºç«‹æ–°å°ˆæ¡ˆæˆ–é¸æ“‡ç¾æœ‰å°ˆæ¡ˆ</li>
                    <li>å•Ÿç”¨ä»¥ä¸‹ API æœå‹™ï¼š
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>Maps JavaScript API</li>
                            <li>Directions API</li>
                            <li>Places API</li>
                        </ul>
                    </li>
                    <li>åœ¨ã€Œæ†‘è­‰ã€é é¢å»ºç«‹ API Key</li>
                    <li>è¤‡è£½ API Key ä¸¦è²¼åˆ°ä¸Šæ–¹è¼¸å…¥æ¡†</li>
                </ol>
                <p style="margin-top: 15px; font-size: 14px; color: #888;">
                    ğŸ’¡ å»ºè­°ï¼šæ¸¬è©¦éšæ®µå¯ä»¥ä¸è¨­é™åˆ¶ï¼Œæ­£å¼ä½¿ç”¨æ™‚è«‹è¨­å®šé©ç•¶çš„ API Key é™åˆ¶
                </p>
            </div>
        </div>

        <!-- ä¸»è¦æ‡‰ç”¨é é¢ -->
        <div class="content hidden" id="mainApp">
            <div class="controls">
                <div class="api-status">
                    âœ… API Key å·²è¨­å®šå®Œæˆ
                </div>

                <button class="btn btn-change-api" onclick="changeApiKey()">ğŸ”„ æ›´æ› API Key</button>

                <div class="input-group">
                    <label>ğŸš— äº¤é€šå·¥å…·</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="travelMode" value="car" checked onchange="updateTravelMode()">
                            <span class="radio-custom"></span>
                            <span class="radio-text">ğŸš— é–‹è»Š (æ¯å…¬é‡Œ NT$ 3)</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="travelMode" value="motorcycle" onchange="updateTravelMode()">
                            <span class="radio-custom"></span>
                            <span class="radio-text">ğŸï¸ æ©Ÿè»Š (æ¯å…¬é‡Œ NT$ 2)</span>
                        </label>
                    </div>
                </div>

                <div class="input-group">
                    <label for="origin">ğŸš© å‡ºç™¼åœ°é»</label>
                    <input type="text" id="origin" placeholder="è«‹è¼¸å…¥å‡ºç™¼åœ°é»">
                </div>

                <div class="input-group">
                    <label for="destination">ğŸ åˆ°é”åœ°é»</label>
                    <input type="text" id="destination" placeholder="è«‹è¼¸å…¥åˆ°é”åœ°é»">
                </div>

                <button class="btn" onclick="showRoutes()">ğŸ” é¡¯ç¤ºè·¯ç·š</button>
                <button class="btn btn-clear" onclick="clearRoute()">ğŸ—‘ï¸ æ¸…é™¤</button>
                <button class="btn btn-print" onclick="printRoute()" id="printBtn" style="display: none;">ğŸ–¨ï¸
                    åˆ—å°</button>

                <div class="loading" id="loading">
                    <p>â³ æ­£åœ¨è¦åŠƒæœ€ä½³åŠæœ€çŸ­è·¯ç·š...</p>
                </div>

                <div class="error" id="error"></div>

                <div id="routeInfo" style="display: none;">
                    <div class="route-info">
                        <h3 style="color: #333; margin-bottom: 15px; display: flex; align-items: center;">
                            ğŸ›£ï¸ æœ€ä½³è·¯ç·š (æ™‚é–“å„ªå…ˆ)
                            <button class="btn-route-select" onclick="showBestRoute()" id="bestRouteBtn">é¡¯ç¤ºæ­¤è·¯ç·š</button>
                        </h3>
                        <div class="route-details">
                            <div class="route-stat">
                                <div class="label">è·é›¢</div>
                                <div class="value" id="bestDistance">-</div>
                            </div>
                            <div class="route-stat">
                                <div class="label">æ™‚é–“</div>
                                <div class="value" id="bestDuration">-</div>
                            </div>
                        </div>
                    </div>

                    <div class="route-info">
                        <h3 style="color: #333; margin-bottom: 15px; display: flex; align-items: center;">
                            ğŸ“ æœ€çŸ­è·¯ç·š (è·é›¢å„ªå…ˆ)
                            <button class="btn-route-select" onclick="showShortestRoute()"
                                id="shortestRouteBtn">é¡¯ç¤ºæ­¤è·¯ç·š</button>
                        </h3>
                        <div class="route-details">
                            <div class="route-stat">
                                <div class="label">è·é›¢</div>
                                <div class="value" id="shortestDistance">-</div>
                            </div>
                            <div class="route-stat">
                                <div class="label">æ™‚é–“</div>
                                <div class="value" id="shortestDuration">-</div>
                            </div>
                        </div>
                    </div>


                    <div class="route-comparison-stats" style="display: none;">
                        <h3>ğŸ“Š è·¯ç·šæ¯”è¼ƒ</h3>
                        <div class="comparison-stats">
                            <div class="comparison-item">
                                <span class="comparison-label">è·é›¢å·®ç•°ï¼š</span>
                                <span class="comparison-value" id="distanceDiff">-</span>
                            </div>
                            <div class="comparison-item">
                                <span class="comparison-label">æ™‚é–“å·®ç•°ï¼š</span>
                                <span class="comparison-value" id="timeDiff">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="right-panel">
                <div class="map-container">
                    <div id="map">
                        <div class="map-placeholder">
                            <div>
                                <div style="font-size: 3em; margin-bottom: 20px;">ğŸ—ºï¸</div>
                                <div>è«‹è¼¸å…¥å‡ºç™¼åœ°é»å’Œåˆ°é”åœ°é»</div>
                                <div style="font-size: 14px; margin-top: 10px; opacity: 0.7;">ç„¶å¾Œé»æ“Šã€Œé¡¯ç¤ºè·¯ç·šã€æŒ‰éˆ•</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="cost-calculation-panel" id="costPanel" style="display: none;">
                    <div class="route-comparison">
                        <h3>ğŸ’° äº¤é€šè²»è¨ˆç®—</h3>
                        <div class="cost-calculation">
                            <div class="trip-info">
                                <div class="trip-detail">
                                    <span class="trip-label">å‡ºç™¼åœ°é»ï¼š</span>
                                    <span class="trip-value" id="tripOrigin">-</span>
                                </div>
                                <div class="trip-detail">
                                    <span class="trip-label">åˆ°é”åœ°é»ï¼š</span>
                                    <span class="trip-value" id="tripDestination">-</span>
                                </div>
                            </div>
                            <div class="cost-breakdown" id="costBreakdown">
                                <div class="cost-item">
                                    <span class="cost-label">é¸æ“‡è·¯ç·šï¼š</span>
                                    <span class="cost-value" id="selectedRouteInfo">-</span>
                                </div>
                                <div class="cost-item">
                                    <span class="cost-label">è¨ˆç®—æ–¹å¼ï¼š</span>
                                    <span class="cost-value" id="costFormula">-</span>
                                </div>
                                <div class="cost-item total-cost">
                                    <span class="cost-label">ä¾†å›ç¸½è²»ç”¨ï¼š</span>
                                    <span class="cost-value" id="totalCost">NT$ 0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åˆ—å°æ¨™é¡Œï¼ˆåªåœ¨åˆ—å°æ™‚é¡¯ç¤ºï¼‰ -->
        <div class="print-header" style="display: none;">
            <h1>äº¤é€šè²»è·¯ç·šåœ–</h1>
            <div id="printHeaderDate"></div>
        </div>
    </div>

    <script>
        let map;
        let directionsService;
        let directionsRenderer;
        let isMapInitialized = false;
        let currentApiKey = '';
        let bestRoute = null;
        let shortestRoute = null;
        let currentDisplayedRoute = 'best';
        let currentTravelMode = 'car'; // 'car' or 'motorcycle'

        // é©—è­‰ä¸¦è¨­å®š API Key
        function validateAndSetApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();

            if (!apiKey) {
                showApiError('è«‹è¼¸å…¥ API Key');
                return;
            }

            if (apiKey.length < 30) {
                showApiError('API Key æ ¼å¼ä¼¼ä¹ä¸æ­£ç¢ºï¼Œè«‹æª¢æŸ¥æ˜¯å¦å®Œæ•´è¤‡è£½');
                return;
            }

            // é¡¯ç¤ºè¼‰å…¥ä¸­
            showApiMessage('ğŸ”„ æ­£åœ¨é©—è­‰ API Key...', 'loading');

            // æ¸¬è©¦ API Key æ˜¯å¦æœ‰æ•ˆ
            testApiKey(apiKey);
        }

        // æ¸¬è©¦ API Key
        function testApiKey(apiKey) {
            currentApiKey = apiKey;

            // å‹•æ…‹è¼‰å…¥ Google Maps API
            const script = document.createElement('script');
            script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&callback=onApiLoaded&libraries=places&language=zh-TW`;
            script.async = true;
            script.defer = true;

            // éŒ¯èª¤è™•ç†
            script.onerror = function () {
                showApiError('API Key ç„¡æ•ˆæˆ–ç¶²è·¯é€£ç·šæœ‰å•é¡Œ');
            };

            document.head.appendChild(script);
        }

        // API è¼‰å…¥å®Œæˆå›èª¿
        window.onApiLoaded = function () {
            try {
                // å˜—è©¦å‰µå»ºä¸€å€‹ç°¡å–®çš„åœ°åœ–ä¾†æ¸¬è©¦ API
                const testMap = new google.maps.Map(document.createElement('div'), {
                    zoom: 10,
                    center: { lat: 25.0330, lng: 121.5654 }
                });

                // å¦‚æœèƒ½æˆåŠŸå‰µå»ºåœ°åœ–ï¼Œè¡¨ç¤º API Key æœ‰æ•ˆ
                showApiSuccess('âœ… API Key é©—è­‰æˆåŠŸï¼æ­£åœ¨é€²å…¥æ‡‰ç”¨...');

                setTimeout(() => {
                    switchToMainApp();
                }, 1500);

            } catch (error) {
                showApiError('API Key é©—è­‰å¤±æ•—ï¼š' + error.message);
            }
        };

        // åˆ‡æ›åˆ°ä¸»æ‡‰ç”¨
        function switchToMainApp() {
            document.getElementById('apiSetup').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
        }

        // æ›´æ› API Key
        function changeApiKey() {
            // é‡ç½®ç‹€æ…‹
            isMapInitialized = false;
            currentApiKey = '';

            // é‡ç½®APIè¨­å®šé é¢çš„é¸é …
            currentTravelMode = 'car';

            // é‡ç½®äº¤é€šå·¥å…·é¸æ“‡
            if (document.querySelector('input[name="travelMode"][value="car"]')) {
                document.querySelector('input[name="travelMode"][value="car"]').checked = true;
            }

            // æ¸…é™¤åœ°åœ–
            if (map) {
                map = null;
            }

            // é‡ç½® UI
            document.getElementById('apiKeyInput').value = '';
            document.getElementById('origin').value = '';
            document.getElementById('destination').value = '';
            document.getElementById('routeInfo').style.display = 'none';
            document.getElementById('costPanel').style.display = 'none';
            document.getElementById('printBtn').style.display = 'none';
            document.getElementById('map').innerHTML = '<div class="map-placeholder"><div><div style="font-size: 3em; margin-bottom: 20px;">ğŸ—ºï¸</div><div>è«‹è¼¸å…¥å‡ºç™¼åœ°é»å’Œåˆ°é”åœ°é»</div><div style="font-size: 14px; margin-top: 10px; opacity: 0.7;">ç„¶å¾Œé»æ“Šã€Œé¡¯ç¤ºè·¯ç·šã€æŒ‰éˆ•</div></div></div>';

            // åˆ‡æ›å› API è¨­å®šé é¢
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('apiSetup').classList.remove('hidden');

            hideApiMessages();
        }

        // æ›´æ–°äº¤é€šå·¥å…·
        function updateTravelMode() {
            const selectedRadio = document.querySelector('input[name="travelMode"]:checked');
            currentTravelMode = selectedRadio.value;

            // å¦‚æœå·²ç¶“æœ‰è·¯ç·šï¼Œé‡æ–°è¨ˆç®—è²»ç”¨
            if (bestRoute && shortestRoute) {
                calculateTransportCost();
            }
        }

        // é¡¯ç¤ºè·¯ç·š
        async function showRoutes() {
            const origin = document.getElementById('origin').value.trim();
            const destination = document.getElementById('destination').value.trim();

            if (!origin || !destination) {
                showError('è«‹è¼¸å…¥å‡ºç™¼åœ°é»å’Œåˆ°é”åœ°é»');
                return;
            }

            showLoading(true);
            hideError();

            try {
                // åˆå§‹åŒ–åœ°åœ–ï¼ˆå¦‚æœé‚„æ²’åˆå§‹åŒ–ï¼‰
                if (!isMapInitialized) {
                    await initializeMap();
                }

                // åŒæ™‚è¦åŠƒæœ€ä½³è·¯ç·šå’Œæœ€çŸ­è·¯ç·š
                await Promise.all([
                    calculateBestRoute(origin, destination),
                    calculateShortestRoute(origin, destination)
                ]);

                // æ›´æ–°UIé¡¯ç¤º
                updateRouteDisplay();
                calculateRouteDifferences();
                calculateTransportCost(); // è¨ˆç®—äº¤é€šè²»ç”¨

                // é¡¯ç¤ºäº¤é€šè²»è¨ˆç®—é¢æ¿å’Œåˆ—å°æŒ‰éˆ•
                document.getElementById('costPanel').style.display = 'block';
                document.getElementById('printBtn').style.display = 'block';

                // é è¨­é¡¯ç¤ºæœ€çŸ­è·¯ç·š
                showShortestRoute();

                showLoading(false);

            } catch (error) {
                showLoading(false);
                showError('è¼‰å…¥è·¯ç·šæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š' + error.message);
                console.error('è·¯ç·šè¦åŠƒéŒ¯èª¤:', error);
            }
        }

        // è¨ˆç®—æœ€ä½³è·¯ç·šï¼ˆæ™‚é–“å„ªå…ˆï¼‰
        function calculateBestRoute(origin, destination) {
            return new Promise((resolve, reject) => {
                // æ ¹æ“šäº¤é€šå·¥å…·è¨­å®šè·¯ç·šæ¨¡å¼
                const travelMode = currentTravelMode === 'motorcycle' ?
                    google.maps.TravelMode.TWO_WHEELER :
                    google.maps.TravelMode.DRIVING;

                const request = {
                    origin: origin,
                    destination: destination,
                    travelMode: travelMode,
                    unitSystem: google.maps.UnitSystem.METRIC,
                    region: 'TW',
                    provideRouteAlternatives: false,
                    optimizeWaypoints: false,
                    avoidHighways: false,
                    avoidTolls: false
                };

                directionsService.route(request, function (result, status) {
                    if (status === 'OK') {
                        bestRoute = result;
                        resolve(result);
                    } else {
                        reject(new Error('æœ€ä½³è·¯ç·šè¦åŠƒå¤±æ•—: ' + status));
                    }
                });
            });
        }

        // è¨ˆç®—æœ€çŸ­è·¯ç·šï¼ˆè·é›¢å„ªå…ˆï¼‰
        function calculateShortestRoute(origin, destination) {
            return new Promise((resolve, reject) => {
                // æ ¹æ“šäº¤é€šå·¥å…·è¨­å®šè·¯ç·šæ¨¡å¼
                const travelMode = currentTravelMode === 'motorcycle' ?
                    google.maps.TravelMode.TWO_WHEELER :
                    google.maps.TravelMode.DRIVING;

                const request = {
                    origin: origin,
                    destination: destination,
                    travelMode: travelMode,
                    unitSystem: google.maps.UnitSystem.METRIC,
                    region: 'TW',
                    provideRouteAlternatives: true, // ç²å–å¤šæ¢è·¯ç·š
                    optimizeWaypoints: true,
                    avoidHighways: false,
                    avoidTolls: false
                };

                directionsService.route(request, function (result, status) {
                    if (status === 'OK') {
                        // å¾å¤šæ¢è·¯ç·šä¸­é¸æ“‡è·é›¢æœ€çŸ­çš„
                        let shortestRouteResult = result;
                        if (result.routes.length > 1) {
                            let minDistance = result.routes[0].legs[0].distance.value;
                            let shortestIndex = 0;

                            for (let i = 1; i < result.routes.length; i++) {
                                const distance = result.routes[i].legs[0].distance.value;
                                if (distance < minDistance) {
                                    minDistance = distance;
                                    shortestIndex = i;
                                }
                            }

                            // å‰µå»ºåªåŒ…å«æœ€çŸ­è·¯ç·šçš„çµæœ
                            shortestRouteResult = {
                                ...result,
                                routes: [result.routes[shortestIndex]]
                            };
                        }

                        shortestRoute = shortestRouteResult;
                        resolve(shortestRouteResult);
                    } else {
                        reject(new Error('æœ€çŸ­è·¯ç·šè¦åŠƒå¤±æ•—: ' + status));
                    }
                });
            });
        }

        // æ›´æ–°è·¯ç·šè³‡è¨Šé¡¯ç¤º
        function updateRouteDisplay() {
            if (!bestRoute || !shortestRoute) return;

            // æœ€ä½³è·¯ç·šè³‡è¨Š
            const bestLeg = bestRoute.routes[0].legs[0];
            document.getElementById('bestDistance').textContent = bestLeg.distance.text;
            document.getElementById('bestDuration').textContent = bestLeg.duration.text;

            // æœ€çŸ­è·¯ç·šè³‡è¨Š
            const shortestLeg = shortestRoute.routes[0].legs[0];
            document.getElementById('shortestDistance').textContent = shortestLeg.distance.text;
            document.getElementById('shortestDuration').textContent = shortestLeg.duration.text;

            // é¡¯ç¤ºè·¯ç·šè³‡è¨Šå€åŸŸ
            document.getElementById('routeInfo').style.display = 'block';
        }

        // è¨ˆç®—è·¯ç·šå·®ç•°
        function calculateRouteDifferences() {
            if (!bestRoute || !shortestRoute) return;

            const bestLeg = bestRoute.routes[0].legs[0];
            const shortestLeg = shortestRoute.routes[0].legs[0];

            // è¨ˆç®—è·é›¢å·®ç•°
            const distanceDiff = Math.abs(bestLeg.distance.value - shortestLeg.distance.value);
            const distanceDiffKm = (distanceDiff / 1000).toFixed(1);

            // è¨ˆç®—æ™‚é–“å·®ç•°
            const timeDiff = Math.abs(bestLeg.duration.value - shortestLeg.duration.value);
            const timeDiffMin = Math.round(timeDiff / 60);

            // æ›´æ–°é¡¯ç¤º
            document.getElementById('distanceDiff').textContent = `${distanceDiffKm} å…¬é‡Œ`;
            document.getElementById('timeDiff').textContent = `${timeDiffMin} åˆ†é˜`;
        }

        // é¡¯ç¤ºæœ€ä½³è·¯ç·š
        function showBestRoute() {
            if (!bestRoute) return;

            directionsRenderer.setDirections(bestRoute);
            currentDisplayedRoute = 'best';

            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.getElementById('bestRouteBtn').classList.add('active');
            document.getElementById('shortestRouteBtn').classList.remove('active');

            // è‡ªå‹•è¨ˆç®—äº¤é€šè²»ç”¨
            calculateTransportCost();
        }

        // é¡¯ç¤ºæœ€çŸ­è·¯ç·š
        function showShortestRoute() {
            if (!shortestRoute) return;

            directionsRenderer.setDirections(shortestRoute);
            currentDisplayedRoute = 'shortest';

            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.getElementById('shortestRouteBtn').classList.add('active');
            document.getElementById('bestRouteBtn').classList.remove('active');

            // è‡ªå‹•è¨ˆç®—äº¤é€šè²»ç”¨
            calculateTransportCost();
        }

        // è¨ˆç®—äº¤é€šè²»ç”¨
        function calculateTransportCost() {
            if (!bestRoute || !shortestRoute) return;

            // æ ¹æ“šç•¶å‰é¡¯ç¤ºçš„è·¯ç·šé€²è¡Œè¨ˆç®—
            const selectedRoute = currentDisplayedRoute === 'best' ? bestRoute : shortestRoute;
            const selectedLeg = selectedRoute.routes[0].legs[0];

            // ç²å–è·é›¢ï¼ˆå…¬é‡Œï¼‰
            const distanceInKm = selectedLeg.distance.value / 1000;

            // æ ¹æ“šäº¤é€šå·¥å…·è¨­å®šæ¯å…¬é‡Œè²»ç”¨
            const ratePerKm = currentTravelMode === 'car' ? 3 : 2;
            const vehicleText = currentTravelMode === 'car' ? 'é–‹è»Š' : 'æ©Ÿè»Š';

            // è¨ˆç®—ä¾†å›è²»ç”¨ï¼ˆè·é›¢ Ã— 2 Ã— æ¯å…¬é‡Œè²»ç”¨ï¼‰
            const totalCost = Math.round(distanceInKm * 2 * ratePerKm);

            // æ›´æ–°é¡¯ç¤º
            document.getElementById('selectedRouteInfo').textContent =
                `${currentDisplayedRoute === 'best' ? 'æœ€ä½³è·¯ç·š' : 'æœ€çŸ­è·¯ç·š'} (${selectedLeg.distance.text})`;

            document.getElementById('costFormula').textContent =
                `${distanceInKm.toFixed(1)} km Ã— 2 (ä¾†å›) Ã— NT$ ${ratePerKm} (${vehicleText})`;

            document.getElementById('totalCost').textContent = `NT$ ${totalCost.toLocaleString()}`;

            // æ›´æ–°å‡ºç™¼åœ°é»å’Œåˆ°é”åœ°é»
            document.getElementById('tripOrigin').textContent = document.getElementById('origin').value || '-';
            document.getElementById('tripDestination').textContent = document.getElementById('destination').value || '-';
        }

        // åˆ—å°åŠŸèƒ½
        function printRoute() {
            if (!bestRoute || !shortestRoute) {
                showError('è«‹å…ˆè¦åŠƒè·¯ç·šæ‰èƒ½åˆ—å°');
                return;
            }

            // è¨­å®šåˆ—å°æ—¥æœŸ
            document.getElementById('printHeaderDate').textContent =
                `åˆ—å°æ—¥æœŸï¼š${new Date().toLocaleDateString('zh-TW')} ${new Date().toLocaleTimeString('zh-TW')}`;

            // ç‚ºå·¦å´æ§åˆ¶é¢æ¿æ·»åŠ  no-print class
            document.querySelector('.controls').classList.add('no-print');

            // å°‡æ¨™é¡Œæ’å…¥åˆ° body çš„æœ€å‰é¢ï¼ˆåˆ—å°æ™‚ï¼‰
            const printHeader = document.querySelector('.print-header');
            document.body.insertBefore(printHeader, document.body.firstChild);

            // åŸ·è¡Œåˆ—å°
            setTimeout(() => {
                window.print();

                // åˆ—å°å®Œæˆå¾Œæ¢å¾©
                setTimeout(() => {
                    document.querySelector('.controls').classList.remove('no-print');
                    // å°‡æ¨™é¡Œç§»å›åŸä½
                    document.querySelector('.container').appendChild(printHeader);
                }, 500);
            }, 100);
        }

        // åˆå§‹åŒ–åœ°åœ–
        function initializeMap() {
            return new Promise((resolve, reject) => {
                try {
                    // æ¸…é™¤ä½”ä½ç¬¦
                    document.getElementById('map').innerHTML = '';

                    // å‰µå»ºåœ°åœ–
                    map = new google.maps.Map(document.getElementById('map'), {
                        zoom: 13,
                        center: { lat: 25.0330, lng: 121.5654 },
                        styles: [
                            {
                                featureType: "water",
                                elementType: "geometry",
                                stylers: [{ color: "#e9e9e9" }, { lightness: 17 }]
                            },
                            {
                                featureType: "landscape",
                                elementType: "geometry",
                                stylers: [{ color: "#f5f5f5" }, { lightness: 20 }]
                            }
                        ]
                    });

                    // å‰µå»ºè·¯ç·šæœå‹™
                    directionsService = new google.maps.DirectionsService();
                    directionsRenderer = new google.maps.DirectionsRenderer({
                        draggable: false,
                        suppressMarkers: false
                    });
                    directionsRenderer.setMap(map);

                    isMapInitialized = true;
                    resolve();

                } catch (error) {
                    reject(error);
                }
            });
        }

        // æ¸…é™¤è·¯ç·š
        function clearRoute() {
            document.getElementById('origin').value = '';
            document.getElementById('destination').value = '';
            document.getElementById('routeInfo').style.display = 'none';
            document.getElementById('costPanel').style.display = 'none';
            document.getElementById('printBtn').style.display = 'none';

            // é‡ç½®è·¯ç·šè³‡æ–™
            bestRoute = null;
            shortestRoute = null;
            currentDisplayedRoute = 'shortest';
            currentTravelMode = 'car';

            // é‡ç½®äº¤é€šå·¥å…·é¸æ“‡
            document.querySelector('input[name="travelMode"][value="car"]').checked = true;

            // é‡ç½®æŒ‰éˆ•ç‹€æ…‹
            document.getElementById('bestRouteBtn').classList.remove('active');
            document.getElementById('shortestRouteBtn').classList.remove('active');

            if (directionsRenderer) {
                directionsRenderer.setDirections({ routes: [] });
            }

            if (map) {
                map.setCenter({ lat: 25.0330, lng: 121.5654 });
                map.setZoom(13);
            }

            hideError();
        }

        // API è¨Šæ¯é¡¯ç¤ºå‡½æ•¸
        function showApiError(message) {
            hideApiMessages();
            const error = document.getElementById('apiError');
            error.textContent = message;
            error.classList.add('show');
        }

        function showApiSuccess(message) {
            hideApiMessages();
            const success = document.getElementById('apiSuccess');
            success.textContent = message;
            success.classList.add('show');
        }

        function showApiMessage(message, type) {
            hideApiMessages();
            if (type === 'loading') {
                const success = document.getElementById('apiSuccess');
                success.textContent = message;
                success.classList.add('show');
            }
        }

        function hideApiMessages() {
            document.getElementById('apiError').classList.remove('show');
            document.getElementById('apiSuccess').classList.remove('show');
        }

        // å…¶ä»–å·¥å…·å‡½æ•¸
        function showLoading(show) {
            const loading = document.getElementById('loading');
            if (show) {
                loading.classList.add('show');
            } else {
                loading.classList.remove('show');
            }
        }

        function showError(message) {
            const error = document.getElementById('error');
            error.textContent = message;
            error.classList.add('show');
        }

        function hideError() {
            const error = document.getElementById('error');
            error.classList.remove('show');
        }

        // Enteréµè™•ç†
        document.addEventListener('DOMContentLoaded', function () {
            // API Key è¼¸å…¥æ¡†
            document.getElementById('apiKeyInput').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') validateAndSetApiKey();
            });
        });

        // å»¶é²è¼‰å…¥ä¸»æ‡‰ç”¨çš„äº‹ä»¶ç›£è½å™¨
        function setupMainAppEventListeners() {
            document.getElementById('origin').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') showRoutes();
            });

            document.getElementById('destination').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') showRoutes();
            });
        }

        // ç•¶åˆ‡æ›åˆ°ä¸»æ‡‰ç”¨æ™‚è¨­å®šäº‹ä»¶ç›£è½å™¨
        const originalSwitchToMainApp = switchToMainApp;
        switchToMainApp = function () {
            originalSwitchToMainApp();
            setTimeout(setupMainAppEventListeners, 100);
        };
    </script>
</body>

</html>